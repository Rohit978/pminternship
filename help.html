<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Application Assistant - Government of India Internship Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
        }
        .tricolor-border-bottom {
            border-bottom: 5px solid;
            border-image-slice: 1;
            border-width: 5px;
            border-image-source: linear-gradient(to right, #ff9933, #ffffff, #138808);
        }
        #chat-messages::-webkit-scrollbar {
            width: 8px;
        }
        #chat-messages::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        #chat-messages::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        #chat-messages::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .message-bubble {
            max-width: 80%;
            word-wrap: break-word;
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col h-screen">

    <header class="bg-white shadow-md tricolor-border-bottom">
        <div class="container mx-auto p-6 flex justify-between items-center">
            <div class="flex items-center">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/55/Emblem_of_India.svg/120px-Emblem_of_India.svg.png" alt="Emblem of India" class="w-12 h-auto mr-4"
                     onerror="this.onerror=null; this.src='https://placehold.co/48x60/EFEFEF/333333?text=Emblem';">
                <div>
                    <h1 class="text-xl font-bold text-gray-800">AI Application Assistant</h1>
                    <p class="text-gray-500">Government of India Internship Portal</p>
                </div>
            </div>
            <a href="index.html" class="text-blue-600 hover:underline font-medium">
                <i class="fas fa-arrow-left mr-2"></i>Back to Home
            </a>
        </div>
    </header>

    <main class="flex-grow container mx-auto p-4 md:p-8 flex justify-center">
        <div class="w-full max-w-4xl bg-white rounded-xl shadow-lg flex flex-col h-full max-h-[80vh]">
            
            <div id="chat-messages" class="flex-grow p-6 space-y-4 overflow-y-auto">
                <div class="flex justify-start">
                    <div class="message-bubble bg-blue-500 text-white p-4 rounded-lg rounded-bl-none">
                        <p>Hello! I am your AI assistant. How can I help you with your application today? Feel free to ask about eligibility, required documents, or even help with building a resume.</p>
                    </div>
                </div>
            </div>

            <div id="typing-indicator" class="p-6 hidden">
                <div class="flex items-center justify-start">
                    <div class="message-bubble bg-gray-200 text-gray-700 p-4 rounded-lg rounded-bl-none flex items-center">
                        <div class="w-2 h-2 bg-gray-500 rounded-full animate-pulse mr-2"></div>
                        <div class="w-2 h-2 bg-gray-500 rounded-full animate-pulse mr-2" style="animation-delay: 0.2s;"></div>
                        <div class="w-2 h-2 bg-gray-500 rounded-full animate-pulse" style="animation-delay: 0.4s;"></div>
                    </div>
                </div>
            </div>

            <div class="p-6 border-t border-gray-200">
                <form id="chat-form" class="flex items-center space-x-4">
                    <input type="text" id="user-input" placeholder="Type your question here..." autocomplete="off" required
                           class="w-full rounded-full border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-4">
                    <button type="submit" class="bg-blue-600 text-white rounded-full p-4 hover:bg-blue-700 transition duration-300">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </form>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const chatForm = document.getElementById('chat-form');
            const userInput = document.getElementById('user-input');
            const chatMessages = document.getElementById('chat-messages');
            const typingIndicator = document.getElementById('typing-indicator');

            const apiKey = "AIzaSyBLxoVx-RkuJeja6n_7JqrJ_O-S_teRhuA"; // Replace with your actual API key
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`;

            // This tells the AI how to behave.
            const systemInstruction = {
                role: "model",
                parts: [{
                    text: `You are an expert AI assistant for the Government of India's Internship Portal. Your name is 'InternBot'. Your sole purpose is to help applicants with their application-related problems.

                    You are knowledgeable about:
                    1.  **Eligibility Criteria:** Age limits, educational qualifications, required percentages (e.g., 10th and 12th marks), and citizenship.
                    2.  **Required Documents:** What documents are needed (e.g., photo ID, academic transcripts, proof of address), their formats (PDF, JPG), and size limits.
                    3.  **Application Process:** How to fill out the form, navigate between sections, and save progress.
                    4.  **Technical Issues:** Common problems like the form not submitting, dropdowns not working, or errors during upload. Provide simple troubleshooting steps (e.g., "try clearing your cache," "check your internet connection," "ensure file sizes are correct").
                    5.  **Application Status:** Explain how a user can check their application status after submission (e.g., "You can log in to the portal and check the 'My Application' section.").

                    **Your Tone:** Be helpful, professional, clear, and concise. Use simple language.
                    **Important:** If you do not know the answer to a very specific or technical question, state that you do not have that information and recommend they contact the official support email at 'internships@gov.in'.
                    **Grounding:** Use the provided search tool to find the most current information if the user's question is not covered in your instructions.`
                }]
            };

            let conversationHistory = [systemInstruction];

            // Function to add a message to the chat window
            const addMessage = (sender, message) => {
                const messageContainer = document.createElement('div');
                messageContainer.className = `flex ${sender === 'user' ? 'justify-end' : 'justify-start'}`;
                
                const bubble = document.createElement('div');
                bubble.className = `message-bubble p-4 rounded-lg ${sender === 'user' ? 'bg-gray-200 text-gray-800 rounded-br-none' : 'bg-blue-500 text-white rounded-bl-none'}`;
                bubble.innerHTML = `<p>${message}</p>`;

                messageContainer.appendChild(bubble);
                chatMessages.appendChild(messageContainer);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            };

            // Handle form submission
            chatForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const userMessage = userInput.value.trim();
                if (!userMessage) return;

                addMessage('user', userMessage);
                userInput.value = '';

                const lowerCaseMessage = userMessage.toLowerCase();

                // **MODIFICATION START**
                // 1. Check for resume-related keywords
                if (lowerCaseMessage.includes('resume') || lowerCaseMessage.includes('cv') || lowerCaseMessage.includes('bio-data')) {
                    typingIndicator.classList.remove('hidden');
                    setTimeout(() => {
                        addMessage('bot', 'Of course! Let me redirect you to the resume builder page.');
                        typingIndicator.classList.add('hidden');
                        setTimeout(() => {
                            window.location.href = 'resume.html';
                        }, 1200); // Wait a moment before redirecting
                    }, 1000); // Simulate thinking
                    return; // Stop the function here
                }

                // 2. Check for developer-related keywords
                if (lowerCaseMessage.includes('developer') || lowerCaseMessage.includes('who made you') || lowerCaseMessage.includes('creator') || lowerCaseMessage.includes('built you')) {
                    typingIndicator.classList.remove('hidden');
                    setTimeout(() => {
                        addMessage('bot', 'I was developed by Team SmartMatch.');
                        typingIndicator.classList.add('hidden');
                    }, 1000); // Simulate thinking
                    return; // Stop the function here
                }
                // **MODIFICATION END**

                // If no special keywords are found, proceed with the API call
                typingIndicator.classList.remove('hidden');

                // Add user message to history
                conversationHistory.push({ role: "user", parts: [{ text: userMessage }] });

                try {
                    const payload = {
                        contents: conversationHistory,
                        tools: [{ "google_search": {} }] // Enable Google Search grounding
                    };

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`API request failed with status ${response.status}`);
                    }

                    const result = await response.json();
                    const candidate = result.candidates?.[0];

                    let botMessage = "I'm sorry, I'm having trouble responding right now. Please try again later.";

                    if (candidate && candidate.content?.parts?.[0]?.text) {
                        botMessage = candidate.content.parts[0].text;
                    }

                    // Add AI response to history and display it
                    conversationHistory.push({ role: "model", parts: [{ text: botMessage }] });
                    addMessage('bot', botMessage);

                } catch (error) {
                    console.error("AI Chatbot Error:", error);
                    addMessage('bot', "There was an error connecting to the AI assistant. Please check your connection and try again.");
                } finally {
                    typingIndicator.classList.add('hidden');
                }
            });
        });
    </script>
</body>
</html>